name: Visual Studio C++ Build

on:
  push:
    branches: [ master ] # å½“ä»£ç æ¨é€åˆ°mainåˆ†æ”¯æ—¶è§¦å‘
  pull_request:
    branches: [ master ] # å½“æœ‰é’ˆå¯¹mainåˆ†æ”¯çš„æ‹‰å–è¯·æ±‚æ—¶è§¦å‘

jobs:
  build_windows_cpp:
    runs-on: windows-latest # åœ¨æœ€æ–°çš„Windowsç¯å¢ƒä¸­è¿è¡Œæ­¤ä½œä¸šï¼Œè¯¥ç¯å¢ƒé¢„è£…Visual Studioå’ŒMSBuild

    steps:
    - name: ğŸ“¦ Checkout repository # æ­¥éª¤1: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      with:
        fetch-depth: 0 # å»ºè®®è·å–å®Œæ•´å†å²ï¼Œä»¥ä¾¿æŸäº›å·¥å…·ï¼ˆå¦‚GitVersionï¼‰æ­£å¸¸å·¥ä½œ

    - name: ğŸ”¨ Build Visual Studio C++ Project # æ­¥éª¤3: ä½¿ç”¨ MSBuild ç¼–è¯‘é¡¹ç›®
      run: |
        # %VSAPPIDDIR% æ˜¯ Visual Studio ç¯å¢ƒå˜é‡ï¼Œé€šå¸¸æŒ‡å‘ MSBuild
        # MSBuild å‘½ä»¤ï¼š
        # - `/p:Configuration=Release` æŒ‡å®šç¼–è¯‘é…ç½® (Release, Debugç­‰)
        # - `/p:Platform=x64` æŒ‡å®šç›®æ ‡å¹³å° (x64, Win32ç­‰)
        # - `/t:Build` æŒ‡å®šæ„å»ºç›®æ ‡ (Build, Rebuild, Cleanç­‰)
        # æ›¿æ¢ YourSolution.sln ä¸ºæ‚¨çš„å®é™…è§£å†³æ–¹æ¡ˆæ–‡ä»¶ååŠå…¶ç›¸å¯¹è·¯å¾„
        # ä¾‹å¦‚ï¼šYourSolution.sln
        # å¦‚æœè§£å†³æ–¹æ¡ˆåœ¨å­ç›®å½•ï¼Œå¦‚ 'src/MyProject/MyProject.sln'
        #"C:\Program Files\Microsoft Visual Studio\2022\Enterprise\MSBuild\Current\Bin\MSBuild.exe" YourSolution.sln /p:Configuration=Release /p:Platform=x64 /t:Build
        
        # ç®€åŒ–å‘½ä»¤ï¼šMSBuildé€šå¸¸åœ¨Pathç¯å¢ƒå˜é‡ä¸­ï¼Œæ— éœ€æŒ‡å®šå®Œæ•´è·¯å¾„
        msbuild JuicyPotato.sln /p:Configuration=Release /p:Platform=x64 /p:ControlFlowGuard=false /t:Build
      # å¦‚æœè§£å†³æ–¹æ¡ˆæ–‡ä»¶ä¸åœ¨ä»“åº“æ ¹ç›®å½•ï¼Œè¯·åœ¨è¿™é‡Œè°ƒæ•´è·¯å¾„ï¼Œä¾‹å¦‚ï¼š
      working-directory: JuicyPotato

    - name: â¬†ï¸ Upload Build Artifacts # æ­¥éª¤4: å¯é€‰ï¼šä¸Šä¼ ç¼–è¯‘åçš„äº§ç‰©
      uses: actions/upload-artifact@v4
      with:
        name: Build-Output-Windows # äº§ç‰©åç§°
        path: |
          # è¯·æ ¹æ®æ‚¨çš„é¡¹ç›®è¾“å‡ºè·¯å¾„è¿›è¡Œè°ƒæ•´
          # å…¸å‹çš„Release x64è¾“å‡ºè·¯å¾„å¯èƒ½åœ¨ Release_x64 æˆ– x64/Release ç›®å½•ä¸‹
          # å‡è®¾æ‚¨çš„è§£å†³æ–¹æ¡ˆåä¸º "YourSolution"ï¼Œé¡¹ç›®åä¸º "YourProject"
          # æ‚¨å¯èƒ½éœ€è¦æ‰¾åˆ° xxx.exe, xxx.dll, xxx.lib ç­‰æ–‡ä»¶
          # ä¾‹å¦‚ï¼šYourSolution/x64/Release/YourProject.exe
          # ä¾‹å¦‚ï¼šYourSolution/Release/YourProject.exe
          JuicyPotato\x64\Release\*.exe  # ç¤ºä¾‹ï¼šä¸Šä¼ æ‰€æœ‰å¯æ‰§è¡Œæ–‡ä»¶
          JuicyPotato\x64\Release\*.dll  # ç¤ºä¾‹ï¼šä¸Šä¼ æ‰€æœ‰åŠ¨æ€é“¾æ¥åº“
          # YourSolution\x64\Release\*.pdb # è°ƒè¯•ç¬¦å·æ–‡ä»¶ (å¯é€‰)
          # YourSolution\x64\Release\*.lib # é™æ€åº“æ–‡ä»¶ (å¯é€‰)
          
          # å¦‚æœæ‚¨çš„é¡¹ç›®è¾“å‡ºåœ¨è§£å†³æ–¹æ¡ˆæ ¹ç›®å½•ä¸‹çš„å…¬å…±æ–‡ä»¶å¤¹ï¼ˆå¦‚ bin/Releaseï¼‰
          # bin/Release/*.exe
          # bin/Release/*.dll
