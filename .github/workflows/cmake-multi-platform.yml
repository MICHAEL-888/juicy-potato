name: Visual Studio C++ Build

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build_windows_cpp:
    runs-on: windows-latest

    steps:
    - name: ğŸ“¦ Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: ğŸ› ï¸ Setup MSVC environment
      uses: microsoft/setup-msbuild@v1

    - name: ğŸ“¥ Restore NuGet packages
      run: nuget restore JuicyPotato/JuicyPotato.sln 

    - name: ğŸ”¨ Build Visual Studio C++ Project
      run: |
        msbuild JuicyPotato.sln `
          /p:Configuration=Release `
          /p:Platform=x64 `
          /p:ControlFlowGuard=false `
          /p:WindowsTargetPlatformVersion=10.0.22621.0 `
          /p:PlatformToolset=v143 `
          /t:Build
      working-directory: JuicyPotato # ç¡®ä¿æ­¤å·¥ä½œç›®å½•æ˜¯ JuciyPotato.sln æ‰€åœ¨çš„ç›®å½•

    - name: ğŸ” List Build Output # **æ–°å¢è°ƒè¯•æ­¥éª¤ï¼šåˆ—å‡ºç¼–è¯‘åçš„æ–‡ä»¶**
      shell: powershell
      run: |
        Write-Host "Listing files under working directory: ${{ github.workspace }}\JuicyPotato"
        # ä½¿ç”¨ recursedir å‘½ä»¤åˆ—å‡ºå½“å‰å·¥ä½œç›®å½•ï¼ˆå³JuicyPotatoæ–‡ä»¶å¤¹ï¼‰ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹
        # è¿™å°†å¸®åŠ©æ‚¨æ‰¾åˆ° .exe å’Œ .dll æ–‡ä»¶çš„å®é™…ä½ç½®
        Get-ChildItem -Path "${{ github.workspace }}\JuicyPotato" -Recurse -Force | Select-Object FullName, Name, Attributes, Length | Format-Table -AutoSize
        
        # ä¹Ÿå¯ä»¥å°è¯•ç›´æ¥åœ¨ PowerShell ä¸­ä½¿ç”¨ dir å‘½ä»¤
        # dir /s "${{ github.workspace }}\JuicyPotato"
        
        Write-Host "--- End of file listing ---"

    - name: â¬†ï¸ Upload Build Artifacts # æ­¥éª¤4: å¯é€‰ï¼šä¸Šä¼ ç¼–è¯‘åçš„äº§ç‰©
      uses: actions/upload-artifact@v4
      with:
        name: Build-Output-Windows # äº§ç‰©åç§°
        # **é‡è¦ï¼šè¿è¡Œä¸€æ¬¡åï¼Œæ ¹æ®`List Build Output`çš„æ—¥å¿—ï¼Œä¿®æ”¹è¿™é‡Œçš„è·¯å¾„ï¼**
        # å‡è®¾è°ƒè¯•åå‘ç°æ–‡ä»¶åœ¨ JuicyPotato\x64\Release\ ç›®å½•ä¸‹ï¼Œåˆ™ä¿æŒä¸å˜
        # å‡è®¾è°ƒè¯•åå‘ç°æ–‡ä»¶åœ¨ JuicyPotato\JuicyPotato\x64\Release\ ç›®å½•ä¸‹ï¼Œåˆ™æ”¹ä¸º path: JuicyPotato\x64\Release\
        # å‡è®¾è°ƒè¯•åå‘ç°æ–‡ä»¶åœ¨ JuicyPotato\Release\x64\ ç›®å½•ä¸‹ï¼Œåˆ™æ”¹ä¸º path: Release\x64\
        path: | 
          JuicyPotato\x64\Release\*.exe  # è¯·æ ¹æ®å®é™…è¾“å‡ºè·¯å¾„è°ƒæ•´æ­¤è¡Œ
          JuicyPotato\x64\Release\*.dll  # è¯·æ ¹æ®å®é™…è¾“å‡ºè·¯å¾„è°ƒæ•´æ­¤è¡Œ
