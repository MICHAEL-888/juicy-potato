name: Visual Studio C++ Build

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build_windows_cpp:
    runs-on: windows-latest

    steps:
    - name: ğŸ“¦ Checkout repository # æ­¥éª¤1: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: ğŸ› ï¸ Setup MSVC environment # **æ–°æ·»åŠ çš„æ­¥éª¤ï¼šè®¾ç½®Visual C++æ„å»ºç¯å¢ƒ**
      uses: microsoft/setup-msbuild@v1 # è¿™ä¸ªActionä¼šç¡®ä¿msbuildåœ¨PATHä¸­å¯ç”¨

    - name: ğŸ“¥ Restore NuGet packages # æ­¥éª¤2: å¯é€‰ï¼šè¿˜åŸ NuGet åŒ…
      run: nuget restore JuicyPotato/JuicyPotato.sln 
      # ç¡®è®¤JuicyPotato.slnçš„æ­£ç¡®è·¯å¾„ã€‚å¦‚æœç›´æ¥åœ¨ä»“åº“æ ¹ç›®å½•ï¼Œåˆ™ä¸º `nuget restore JuicyPotato.sln`

    - name: ğŸ”¨ Build Visual Studio C++ Project # æ­¥éª¤3: ä½¿ç”¨ MSBuild ç¼–è¯‘é¡¹ç›®
      run: |
        msbuild JuicyPotato.sln `
          /p:Configuration=Release `
          /p:Platform=x64 `
          /p:ControlFlowGuard=false `
          /t:Build
      working-directory: JuicyPotato # ç¡®è®¤JuicyPotato.slnæ‰€åœ¨æ–‡ä»¶å¤¹ï¼Œç¡®ä¿è·¯å¾„æ­£ç¡®

    - name: â¬†ï¸ Upload Build Artifacts # æ­¥éª¤4: å¯é€‰ï¼šä¸Šä¼ ç¼–è¯‘åçš„äº§ç‰©
      uses: actions/upload-artifact@v4
      with:
        name: Build-Output-Windows # äº§ç‰©åç§°
        path: |
          JuicyPotato\x64\Release\*.exe  # ç¤ºä¾‹è·¯å¾„ï¼Œè¯·æ ¹æ®å®é™…è¾“å‡ºè°ƒæ•´
          JuicyPotato\x64\Release\*.dll  # ç¤ºä¾‹è·¯å¾„ï¼Œè¯·æ ¹æ®å®é™…è¾“å‡ºè°ƒæ•´
