name: Visual Studio C++ Build

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build_windows_cpp:
    runs-on: windows-latest

    steps:
    - name: ğŸ“¦ Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: ğŸ› ï¸ Setup MSVC environment
      uses: microsoft/setup-msbuild@v1

    - name: ğŸ“¥ Restore NuGet packages 
      run: nuget restore JuicyPotato/JuicyPotato.sln 

    - name: ğŸ”¨ Build Visual Studio C++ Project
      run: |
        msbuild JuicyPotato.sln `
          /p:Configuration=Release `
          /p:Platform=x64 `
          /p:ControlFlowGuard=false `
          /p:WindowsTargetPlatformVersion=10.0.22621.0 `
          /p:PlatformToolset=v143 `
          /t:Build
      working-directory: JuicyPotato 

    # ç§»é™¤è°ƒè¯•æ­¥éª¤ `ğŸ” List Build Output`ï¼Œå› ä¸ºå®ƒå·²ç»å®Œæˆäº†å®ƒçš„ä½¿å‘½
    # å¦‚æœæ‚¨éœ€è¦å®ƒï¼Œå¯ä»¥ä¿ç•™ï¼Œä½†é€šå¸¸åœ¨å®šä½é—®é¢˜åä¼šåˆ é™¤ä»¥å‡å°‘æ—¥å¿—å™ªéŸ³å’Œè¿è¡Œæ—¶é—´

    - name: â¬†ï¸ Upload Build Artifacts # æ­¥éª¤4: ä¸Šä¼ ç¼–è¯‘åçš„äº§ç‰©
      uses: actions/upload-artifact@v4
      with:
        name: Build-Output-Windows # äº§ç‰©åç§°
        path: |
          # ***** å…³é”®ä¿®å¤ï¼šè·¯å¾„ç°åœ¨æ˜¯ç›¸å¯¹äº working-directory: JuicyPotato çš„ *****
          Release\x64\*.exe  # å®é™…çš„ .exe æ–‡ä»¶è·¯å¾„
          Release\x64\*.pdb  # è°ƒè¯•ç¬¦å·æ–‡ä»¶ï¼ˆé€šå¸¸ä¹Ÿéœ€è¦ä¸Šä¼ ï¼‰
          # å¦‚æœæœ‰ .dll æ–‡ä»¶ï¼Œä¹Ÿè¦æ·»åŠ ï¼š
          # Release\x64\*.dll
