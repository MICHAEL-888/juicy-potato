name: Visual Studio C++ Build

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build_windows_cpp:
    runs-on: windows-latest

    steps:
    - name: 📦 Checkout repository # 步骤1: 检出代码
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: 🛠️ Setup MSVC environment # **新添加的步骤：设置Visual C++构建环境**
      uses: microsoft/setup-msbuild@v1 # 这个Action会确保msbuild在PATH中可用

    - name: 📥 Restore NuGet packages # 步骤2: 可选：还原 NuGet 包
      run: nuget restore JuicyPotato/JuicyPotato.sln 
      # 确认JuicyPotato.sln的正确路径。如果直接在仓库根目录，则为 `nuget restore JuicyPotato.sln`

    - name: 🔨 Build Visual Studio C++ Project # 步骤3: 使用 MSBuild 编译项目
      run: |
        msbuild JuicyPotato.sln `
          /p:Configuration=Release `
          /p:Platform=x64 `
          /p:ControlFlowGuard=false `
          /t:Build
      working-directory: JuicyPotato # 确认JuicyPotato.sln所在文件夹，确保路径正确

    - name: ⬆️ Upload Build Artifacts # 步骤4: 可选：上传编译后的产物
      uses: actions/upload-artifact@v4
      with:
        name: Build-Output-Windows # 产物名称
        path: |
          JuicyPotato\x64\Release\*.exe  # 示例路径，请根据实际输出调整
          JuicyPotato\x64\Release\*.dll  # 示例路径，请根据实际输出调整
